1.Png에서 Not for Profit. Not for Data. Built for Dignity를 마우스로 클릭하면 diplomacy.html을 넘어가게 만들거야. 
새로운 창이 아니라 현재창 그대로 넘어가는 거야. Not for Profit. Not for Data. Built for Dignity는 파란색에 밑줄을 쳐야 돼. 원본 블록과 
수정본을 제시해줘. 그냥 붙여 넣기 하게 원본 블록 삭제하고 수정본 첨부하면 된다. 이런 식으로 알려줘. 2번 이미지에서 44KB Offline AI click 보이지? 
마우스로 클릭하면 diplomacy.html을 넘어가게 만들거야. 이것 역시 44KB Offline AI click에 밑줄을 쳐야 돼.



<!-- Paste this inside <body>. No outer <html>/<head>/<body> wrappers. -->
<style>
:root{color-scheme:light dark}
/* Sample.txt geometry: keep the same collapsed size and typography. */
@media (min-width:992px){
  #infoRail{position:fixed;left:14px;top:150px;width:160px;z-index:80;transition:width .22s ease}
  #infoRail:hover,#infoRail:focus-within{width:min(300px,28vw)}
}
@media (max-width:991.98px){
  #infoRail{position:fixed;left:10px;bottom:12px;width:min(75vw,280px);z-index:80;transition:width .22s ease}
  #infoRail:hover,#infoRail:focus-within{width:min(92vw,460px)}
}
/* Box visuals copied from sample.txt with minor accessibility tweaks */
#box{background:#fffbea;border:1px solid rgba(0,0,0,.12);border-radius:8px;box-shadow:0 6px 14px rgba(2,6,23,.08);overflow:hidden;font:.8rem/1.4 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:#0b1221;opacity:.58;filter:saturate(.9) contrast(.95);transition:max-height .24s ease,opacity .18s ease,filter .18s ease,box-shadow .18s ease,transform .18s ease;max-height:var(--collapsed-h,160px);position:relative}
#box header{padding:4px 6px;font-weight:800;background:linear-gradient(180deg,#fffbea,#fff7d6);border-bottom:1px solid rgba(0,0,0,.08);font-size:.82rem}
#box .row{padding:4px 6px}
/* Expanded reading on hover/focus */
#box:hover,#box:focus-within,#box.active{opacity:1;filter:none;box-shadow:0 10px 22px rgba(2,6,23,.12);transform:translateY(-1px);max-height:var(--expanded-h,1000px)}

/* Controls: switch to grid so button never clips; input may shrink */
#controls{display:grid;grid-template-columns:1fr auto;gap:4px;align-items:center}
#q{min-width:0;flex:1;padding:3px 5px;border:1px solid rgba(0,0,0,.16);border-radius:6px;outline:none;font-size:.72rem}
#riskBtn{padding:3px 6px;border-radius:6px;border:1px solid #e8b7b7;background:#ffe1e1;color:#7a2a2a;font-weight:800;cursor:pointer;font-size:.72rem}

#name{font-weight:800;color:#0b1221}
.badge{font-weight:800}
.green{color:#16a34a}.black{color:#0b1221}.red{color:#b01919}
#desc{color:#0b0f19;font-weight:700;font-size:.78rem;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}
#more{font-size:.72rem;color:#0b1221}
#period{font-size:.72rem;opacity:.9;margin-top:2px}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
#infoRail:hover #desc,#infoRail:focus-within #desc{display:block;-webkit-line-clamp:unset;-webkit-box-orient:unset;overflow:visible}
#infoRail:hover #more,#infoRail:focus-within #more{overflow:visible}
</style>
<aside id="infoRail" aria-label="Sticky world travel ticker">
  <div id="box" role="group">
    <header>
      <div>World Travel Ticker AI</div>
      <div id="period">Assessed using data from January 1, 2020 through October 1, 2024.</div>
    </header>
    <div class="row" id="controls">
      <input id="q" list="countries" placeholder="Country… (ex. Japan)" autocomplete="off"/>
      <datalist id="countries"></datalist>
      <button id="riskBtn" type="button" title="Show risky countries">Risk</button>
    </div>
    <div class="row" id="view" aria-live="polite">
      <div id="name">—</div>
      <div id="rank">—</div>
      <div id="grade">—</div>
      <div id="desc">Choose a country or press Risk.</div>
      <div id="more"></div>
    </div>
    <div id="sr" class="sr-only" aria-live="polite"></div>
  </div>
</aside>
<script>
(function(){
  // Rotation baseline in seconds; ensure one timer only. Collapsed height must never go below sample size.
  const ROT_MS=20000, USER_LOCK_MS=40000, COLLAPSE_PCT=0.60, MIN_COLLAPSED=160;

  const rail=document.getElementById('infoRail');
  const box=document.getElementById('box'), q=document.getElementById('q'), dl=document.getElementById('countries'), riskBtn=document.getElementById('riskBtn');
  const elN=document.getElementById('name'), elR=document.getElementById('rank'), elG=document.getElementById('grade'), elD=document.getElementById('desc'), elM=document.getElementById('more'), sr=document.getElementById('sr'), view=document.getElementById('view');

  const LS_KEY='wtta.last';
  const GEXP={"A+":"Exceptional safety across regions.","A":"Very safe, though not absolute best.","A-":"Safe overall with minor caveats.","B+":"Generally safe for visitors.","B":"Safe, some instability to watch.","B-":"Mostly safe, borderline in parts.","C+":"Acceptable but uneven safety.","C":"Fine by day, caution at night.","C-":"Daytime ok, avoid roaming at night.","D+":"Poor safety in notable areas.","D":"Poor; metro zones only feel stable.","D-":"Poor; even metro areas feel risky.","E+":"Very poor; avoid travel, escort advised. ☠️","E":"Very poor; escort advised, avoid travel. ☠️","E-":"Extremely poor; do not visit. ☠️","F":"Worst level; absolute no-go. ☠️☠️"};
  const riskRe=/^(D|E|F)/;
  const gradeOrder={"F":0,"E-":1,"E":2,"E+":3,"D-":4,"D":5,"D+":6,"C-":7,"C":8,"C+":9,"B-":10,"B":11,"B+":12,"A-":13,"A":14,"A+":15};

  function gColor(g){if(/^A|^B/.test(g))return'green';if(/^C/.test(g))return'black';return'red'}
  function save(c){try{localStorage.setItem(LS_KEY,c)}catch(e){}}
  function load(){try{return localStorage.getItem(LS_KEY)||''}catch(e){return''}}
  function pick(a){return a[Math.floor(Math.random()*a.length)]}
  function asString(x){ if(typeof x==='string') return x; if(x&&typeof x.name==='string') return x.name; return '' }
  function cleanInput(v){ return asString(v).replace(/\s*\((risk|safe\s*#\d+)\)\s*$/i,'').trim() }
  function trim(s){return (typeof s==='string'?s:'').replace(/\s+/g,' ').trim()}
  function grams(s){ s=asString(s).toLowerCase(); s=(' '+s+' ').replace(/[^a-z\s]/g,''); const g=new Set(); for(let i=0;i<s.length-2;i++) g.add(s.slice(i,i+3)); return g }
  function jacc(a,b){const A=grams(a),B=grams(b);let inter=0;A.forEach(x=>{if(B.has(x))inter++});return inter/Math.max(1,A.size+B.size-inter)}
  function bestMatch(name){ const s=asString(name).toLowerCase().trim(); if(!s) return ''; if(DB[s]) return s; let best='',sc=0; for(const k of Object.keys(DB)){const v=jacc(s,k); if(v>sc){sc=v;best=k}} return sc>.18?best:'' }
  function cls(el,c){el.classList.remove('green','black','red');el.classList.add(c)}
  function micro(){return 'Safety Grade A+ to F. Grades reflect public guidance on crime, night risk, transit safety, and access to help.'}
  function core(o){const a=[];a.push('Money '+o.cost+'.');a.push(' English '+o.eng+'.');a.push(' Exchange '+o.fx+'.');a.push(' Risks '+o.r1.toLowerCase()+', '+o.r2.toLowerCase()+'.');a.push(' Tip '+o.tip+'.');return trim(a.join(''))}
  function full(o){const s=[];s.push('Safety '+o.grade+': '+GEXP[o.grade]+' Based on 2020–2024 guidance, urban cores and transport nodes shape the visitor experience.');s.push(' Money '+o.cost+' and payments '+(o.fx==='Easy'?'work almost everywhere':'may need cash outside hubs')+'.');s.push(' English '+o.eng+' and signage varies by region; download offline maps and phrase lists.');s.push(' Common issues include '+o.r1.toLowerCase()+' and '+o.r2.toLowerCase()+', typically around crowds, stations, or nightlife.');s.push(' Practical moves: use official taxis or transit cards, keep phones pocketed curbside, photocopy IDs, and confirm prices before rides.');s.push(' For calmer trips, aim for daylight intercity travel, reserve entries, and ask hotels to call trusted drivers.');return trim(s.join(' '))}
  function mkObj(line){const p=(line||'').split('|');const name=p[0]||'';const rank=p[1]||'-';const grade=p[2]||'C';const cost=p[3]||'Moderate';const eng=p[4]||'Moderate';const fx=p[5]||'Moderate';const r1=p[6]||'Theft';const r2=p[7]||'Scams';const tip=p[8]||'Use official options';return {key:asString(name).toLowerCase(),name:asString(name),rank:rank==='-'?null:Number(rank),grade,cost,eng,fx,r1,r2,tip}};

  // Data (tourism ranks + risk set)
  const TOK=[
    'France|1|A-|Expensive|Moderate|Easy|Pickpockets|Transit scams|Book top museums in advance to avoid lines',
    'Spain|2|B+|Moderate|Moderate|Easy|Bag snatch|Beach theft|Use lockers and keep bags zipped on metros',
    'United States|3|B|Expensive|Easy|Easy|Car break-ins|Card fraud|Use park-and-ride and tap-to-pay where possible',
    'China|4|B|Moderate|Difficult|Moderate|Taxi scams|Tea scams|Use official apps and avoid unsolicited invites',
    'Italy|5|B+|Moderate|Moderate|Easy|Station pickpockets|Distraction|Board trains early and keep bags in sight',
    'Turkey|6|B|Cheap|Moderate|Easy|Taxi overcharge|Counterfeits|Use Istanbul cards and official taxis',
    'Mexico|7|B-|Cheap|Moderate|Easy|ATM skimmers|Beach theft|Use ATMs inside banks and hotel safes',
    'Thailand|8|B|Cheap|Moderate|Easy|Tuk-tuk scams|Gem scams|Agree prices before rides and avoid “free” tours',
    'Germany|9|A-|Expensive|Moderate|Easy|Festival theft|Transit pickpockets|Use inside pockets at events',
    'United Kingdom|10|A-|Expensive|Easy|Easy|Phone snatch|Ticket fraud|Pay contactless; avoid unofficial sellers',
    'Japan|11|A+|Moderate|Moderate|Easy|Bar scams|Lost items|Use IC cards and official night venues',
    'Austria|12|A|Expensive|Moderate|Easy|Tram pickpockets|Tour scams|Validate tickets and keep bags front-facing',
    'Greece|13|B|Moderate|Easy|Moderate|Taxi scams|Rental issues|Use licensed ferries and check rental contracts',
    'Malaysia|14|A-|Cheap|Easy|Easy|Snatch theft|ATM skimmers|Use ride-hail and keep bags cross-body',
    'Korea, Republic of (South Korea)|15|A|Moderate|Moderate|Easy|Phone scams|Transit crowding|Use T-money and keep devices secure',
    'Hong Kong|16|A-|Expensive|Easy|Easy|Market pickpockets|Phone scams|Use Octopus card; ignore unsolicited calls',
    'Netherlands|17|A-|Expensive|Easy|Easy|Bike theft|Station theft|Lock bikes twice and watch bags',
    'Portugal|18|B+|Moderate|Moderate|Easy|Car break-ins|Pickpockets|Empty cars at viewpoints; use city lots',
    'Saudi Arabia|19|A-|Moderate|Moderate|Easy|Legal issues|Traffic fines|Respect local laws and speed cameras',
    'United Arab Emirates|20|A|Expensive|Easy|Easy|Traffic fines|Heat stress|Use Nol card and plan indoor breaks',
    'Canada|21|A-|Expensive|Easy|Easy|Car break-ins|Phone theft|Keep gear out of sight at trailheads',
    'Australia|22|A-|Expensive|Easy|Easy|Beach theft|Sun risks|Use Opal/Myki; observe surf flags',
    'New Zealand|23|A|Expensive|Easy|Easy|Trailhead theft|Rural hazards|Leave no valuables in cars',
    'Singapore|24|A+|Expensive|Easy|Easy|Fines|Littering fines|Know local rules; e-payments everywhere',
    'Switzerland|25|A|Expensive|Moderate|Easy|Station theft|Crowd scams|Use Half-Fare; keep bags close',
    'Czechia|26|B+|Moderate|Moderate|Easy|Exchange scams|Old town theft|Use ATMs in banks; avoid street changers',
    'Ireland|27|A-|Expensive|Easy|Easy|Nightlife theft|Phone snatch|Use inside pockets in busy streets',
    'Belgium|28|A-|Expensive|Easy|Easy|Station theft|Festival pickpockets|Keep zips forward in crowds',
    'Norway|29|A|Expensive|Easy|Easy|Weather|Bike theft|Prepare for weather; lock bikes',
    'Sweden|30|A|Expensive|Easy|Easy|Bike theft|Festival theft|Tap-to-pay and watch bags',
    'Indonesia|31|B|Cheap|Moderate|Easy|Taxi overcharge|Beach theft|Use Blue Bird or apps; count change',
    'Vietnam|32|B|Cheap|Moderate|Moderate|Motorbike snatch|Tour scams|Keep phones inside; book reputable tours',
    'Taiwan|33|A-|Moderate|Moderate|Easy|Market theft|Typhoons|Carry cash lite; monitor weather',
    'Morocco|34|B|Cheap|Moderate|Moderate|Souk hustles|Taxi overcharge|Use petit taxi meters; negotiate first',
    'Argentina|35|C+|Cheap|Moderate|Moderate|Card skimming|Night theft|Use bank ATMs; keep small cash',
    'Chile|36|B+|Moderate|Moderate|Easy|Terminal theft|Protests|Use official buses; check advisories',
    'Croatia|37|B+|Moderate|Easy|Easy|High-season scams|Parking scams|Pay official lots; confirm bookings',
    'Poland|38|B+|Moderate|Moderate|Easy|Exchange issues|Old town theft|Avoid street kiosks; use banks',
    'Denmark|39|A|Expensive|Easy|Easy|Bike theft|Night pickpockets|Register bikes; tap-to-pay',
    'Finland|40|A|Expensive|Easy|Easy|Winter risk|Bike theft|Dress for cold; secure bikes',
    'Iceland|41|A-|Expensive|Easy|Easy|Weather shifts|Road ice|Book 4x4 in winter; check forecasts',
    'Slovenia|42|A-|Moderate|Easy|Easy|Trail mishaps|Car break-ins|Validate vignettes; park in lit areas',
    'Slovakia|43|B+|Moderate|Moderate|Easy|Pickpockets|Ticket checks|Validate tickets; carry small cash',
    'Hungary|44|B+|Moderate|Moderate|Easy|Taxi overcharge|Bar scams|Use licensed taxis; check menus',
    'Romania|45|B|Cheap|Moderate|Moderate|ATM skimmers|Rural driving|Use bank ATMs; drive by day',
    'Bulgaria|46|B|Cheap|Moderate|Moderate|Tram checks|Taxi overcharge|Use official apps; keep tickets',
    'Serbia|47|B|Cheap|Moderate|Moderate|Night theft|Unmetered taxis|Use app cabs; stay lit streets',
    'Montenegro|48|B|Moderate|Moderate|Moderate|Parking scams|Coastal theft|Use guarded lots; early starts',
    'North Macedonia|49|B|Cheap|Moderate|Moderate|Market theft|Night buses|Use tourist shuttles; day travel',
    'Albania|50|B-|Cheap|Moderate|Moderate|Road rules|Beach theft|Prefer daylight drives; secure parking',
    'Bosnia and Herzegovina|51|B-|Cheap|Moderate|Moderate|Memorial sensitivity|Road hazards|Use marked routes; respect sites',
    'Malta|52|A-|Expensive|Easy|Easy|Beach theft|Heat|Use lockers; hydrate',
    'Cyprus|53|A-|Moderate|Easy|Easy|Road left|Beach theft|Drive left; watch currents',
    'Luxembourg|54|A-|Expensive|Easy|Easy|Pickpockets|None major|Use free transit; central stays',
    'Monaco|55|A-|Expensive|Easy|Easy|Price shocks|Pickpockets|Day-trip by train from Nice',
    'Andorra|56|A-|Moderate|Moderate|Moderate|Winter roads|Altitude|Carry chains; fuel early',
    'San Marino|57|A-|Moderate|Moderate|Moderate|Crowd theft|Steep paths|Wear grip shoes; day-trip via Rimini',
    'Lithuania|58|A-|Moderate|Easy|Easy|Old town theft|Ticket checks|Tap-to-pay; validate tickets',
    'Latvia|59|A-|Moderate|Easy|Easy|Nightlife theft|Station theft|Keep bags front; use city passes',
    'Estonia|60|A-|Moderate|Easy|Easy|Bike theft|Winter ice|Lock bikes; walk carefully in ice',
    'Jordan|61|B|Moderate|Easy|Moderate|Desert hazards|Ticket touts|Use licensed guides; hydrate',
    'Oman|62|A-|Expensive|Moderate|Moderate|Desert driving|Heat|Use 4x4 for wadis; plan fuel',
    'Qatar|63|A-|Expensive|Easy|Easy|Road fines|Heat|Use metro; respect local rules',
    'Bahrain|64|A-|Moderate|Easy|Easy|Night driving|Heat|Use rideshares; hydrate',
    'Israel|65|B|Expensive|Easy|Easy|Security checks|Scams|Follow guidance; official routes only',
    'Georgia|66|B|Cheap|Moderate|Moderate|Mountain roads|Night theft|Hire vetted drivers; day travel',
    'Armenia|67|B|Cheap|Moderate|Moderate|Border zones|Rural roads|Use licensed drivers; carry cash',
    'Sri Lanka|68|B|Cheap|Moderate|Moderate|Beach touts|Train crowding|Reserve seats; day travel',
    'Nepal|69|B-|Cheap|Moderate|Moderate|Altitude|Night roads|Hire guides; monitor weather',
    'Bhutan|70|A-|Expensive|Moderate|Moderate|Mountain roads|Altitude|Book via authorized operators',
    'Uzbekistan|71|B|Cheap|Moderate|Moderate|Taxi overcharge|Pickpockets|Use Yandex/official cabs',
    'Kazakhstan|72|B|Moderate|Moderate|Moderate|Road checks|Night theft|Use city taxis; carry copies',
    'Kyrgyzstan|73|B-|Cheap|Moderate|Moderate|Mountain roads|Night buses|Use guides; day crossings',
    'Mauritius|74|A-|Expensive|Easy|Easy|Beach theft|Road left|Use hotel safes; drive left',
    'Seychelles|75|A-|Expensive|Moderate|Moderate|Beach theft|Currents|Beware rip currents; secure villas',
    'Fiji|76|B+|Moderate|Moderate|Moderate|Resort theft|Cyclones|Use safes; watch season',
    'Maldives|77|A-|Expensive|Moderate|Moderate|Resort theft|Currents|Follow island rules; guided snorkeling',
    'Rwanda|78|A-|Moderate|Moderate|Moderate|Road checks|Park rules|Book permits; use official guides',
    'Ghana|79|B|Moderate|Moderate|Moderate|Phone snatch|Market theft|Use hotel taxis; conceal phones',
    'Senegal|80|B|Moderate|Moderate|Moderate|Beach theft|Night roads|Use known areas; day trips',
    'Namibia|81|A-|Moderate|Moderate|Moderate|Desert driving|Wildlife|Fuel often; avoid night drives',
    'Botswana|82|A-|Expensive|Moderate|Moderate|Wildlife roads|Cash in villages|Guided safaris; cash small bills',
    'Zambia|83|B+|Moderate|Moderate|Moderate|Border touts|Night roads|Use official exchanges; day border runs',
    // Higher risk selection (no tourism rank)
    'Kenya|-|C+|Moderate|Moderate|Moderate|Mugging|Border terror|Use registered cabs; avoid isolated parks at night',
    'Tanzania|-|C+|Cheap|Moderate|Moderate|Snatch theft|Ferry theft|Use hotel taxis; keep phones hidden near roads',
    'Nigeria|-|D|Moderate|Moderate|Moderate|Kidnapping|Fraud|Use secure transfers; vary routes',
    'Ethiopia|-|D|Cheap|Moderate|Moderate|Civil unrest|Robbery|Avoid protests; shelter in secure hotels',
    'Egypt|-|C|Cheap|Moderate|Moderate|Harassment|Sinai terror|Dress modestly; licensed guides only',
    'Lebanon|-|D|Moderate|Moderate|Moderate|Unrest|Border kidnapping|Avoid protests; trusted drivers only',
    'Pakistan|-|D+|Cheap|Moderate|Moderate|Terror threats|Kidnapping|Avoid crowds; escorts where advised',
    'India|-|C+|Cheap|Moderate|Moderate|Scam hubs|Harassment|Prepaid taxis; keep copies of documents',
    'Dominican Republic|-|C|Moderate|Moderate|Moderate|Drink spiking|Resort theft|Use room safes; hotel taxis',
    'Jamaica|-|C|Moderate|Moderate|Moderate|Robbery|Assault|Avoid night walks; stay in known zones',
    'Belize|-|C|Moderate|Moderate|Moderate|District robberies|Night roads|Use authorized tours; avoid isolated beaches',
    'Paraguay|-|C|Cheap|Moderate|Moderate|Phone theft|ATM fraud|Use ride-hail; bank ATMs only',
    'Tunisia (south)|-|C|Cheap|Moderate|Moderate|Desert risk|Border terror|Avoid remote drives without permits',
    'Mozambique|-|C|Cheap|Moderate|Moderate|Break-ins|Armed robbery|Avoid dusk travel; guarded parking',
    'Madagascar|-|C|Cheap|Moderate|Moderate|Rural robbery|Night walking|Join daytime tours; avoid isolated roads',
    'Bolivia|-|C|Cheap|Moderate|Moderate|Bus theft|Currency scams|Use official counters; no night buses',
    'Honduras|-|D|Cheap|Moderate|Moderate|Gang violence|Robbery|Avoid secluded areas; travel in groups',
    'Guatemala|-|D|Cheap|Moderate|Moderate|Bus robberies|Extortion|Tourist shuttles; small cash only',
    'El Salvador|-|D|Cheap|Moderate|Moderate|Gang threats|Extortion|Main routes only; phones concealed',
    'Colombia|-|D+|Moderate|Moderate|Moderate|Express kidnapping|Robbery|Ride-hail; avoid street ATMs',
    'Brazil|-|D+|Moderate|Moderate|Moderate|Armed robbery|Carjacking|Avoid empty beaches at dusk',
    'Peru|-|C+|Cheap|Moderate|Moderate|Street robbery|Roadblocks|Join reputable tours; avoid isolated viewpoints',
    'Ecuador|-|D|Cheap|Moderate|Moderate|Kidnapping|Extortion|Avoid border hotspots; trusted taxis',
    'Trinidad and Tobago|-|D|Moderate|Moderate|Moderate|Shootings|Robbery|Hotel taxis; limit night travel',
    'South Africa|-|D|Moderate|Moderate|Moderate|Carjacking|Armed robbery|Doors locked; daylight routes'
  ];

  const DB={}, ITEMS=TOK.map(mkObj); for(const o of ITEMS){DB[asString(o.name).toLowerCase()]=o}
  const GOOD = ITEMS.filter(o=>o.rank!=null).sort((a,b)=>a.rank-b.rank);
  const RISK_ALL = ITEMS.filter(o=>riskRe.test(o.grade));
  const RISK_SORTED = RISK_ALL.slice().sort((a,b)=> (gradeOrder[a.grade]??99)-(gradeOrder[b.grade]??99) || a.name.localeCompare(b.name));
  const names=ITEMS.map(o=>o.name).sort();
  names.forEach(n=>{ const o=DB[asString(n).toLowerCase()]; const label=riskRe.test(o.grade)?`${o.name} (RISK)`:(o.rank!=null?`${o.name} (SAFE #${o.rank})`:o.name); const op=document.createElement('option'); op.value=label; op.setAttribute('data-name',o.name); dl.appendChild(op); });

  // Interest-aware description cycling
  let interest=0, hoverId=null, mode='core';
  function setMode(){mode=interest>=3?'deep':'core'}
  function startHover(){if(hoverId)return;hoverId=setInterval(()=>{interest=Math.min(10,interest+1);setMode();show(curr,false)},1000)}
  function stopHover(){clearInterval(hoverId);hoverId=null}

  // Auto-rotate: strictly one timer, 20s each step, good ↔ risk alternating
  let rotId=null, visible=true, userLock=null, goodIdx=0, phase='good';
  function step(){ if(phase==='good'){ const o=GOOD[goodIdx % GOOD.length]; goodIdx++; show(o,false); phase='risk'; } else { const o=pick(RISK_ALL); show(o,false); phase='good'; } }
  function startAuto(){ if(rotId||!visible) return; rotId=setInterval(()=>{ if(!userLock&&visible){ step() } }, ROT_MS) }
  function stopAuto(){ clearInterval(rotId); rotId=null }
  function lock(){ if(userLock) clearTimeout(userLock); stopAuto(); userLock=setTimeout(()=>{ userLock=null; startAuto(); }, USER_LOCK_MS) }

  // Input behaviors
  q.addEventListener('focus',()=>{ stopAuto() });
  q.addEventListener('blur',()=>{ startAuto() });
  q.addEventListener('mouseenter',()=>{ q.value=''; q.style.color=''; });
  q.addEventListener('pointerdown',()=>{ q.value=''; q.style.color=''; });

  // Box hover signals interest
  box.addEventListener('pointerenter',startHover);
  box.addEventListener('pointerleave',()=>{ stopHover(); interest=Math.max(0,interest-.5); setMode(); show(curr,false) });

  // Visible only when intersecting
  const io=new IntersectionObserver(es=>{ es.forEach(e=>{ visible=e.isIntersecting; if(visible) startAuto(); else stopAuto(); }) }); io.observe(box);

  // Height calculation: collapse to max(sample size, 60% of full)
  let roPending=false,lastFull=0,lastCol=0;
  function recalc(){ try{ const prev=box.style.maxHeight; box.style.maxHeight='none'; const full=box.scrollHeight; const collapsed=Math.max(MIN_COLLAPSED, Math.round(full*COLLAPSE_PCT)); box.style.maxHeight=prev; if(full===lastFull&&collapsed===lastCol) return; lastFull=full; lastCol=collapsed; box.style.setProperty('--expanded-h', full+'px'); box.style.setProperty('--collapsed-h', collapsed+'px'); }catch(_){} }
  function qRec(){ if(roPending) return; roPending=true; requestAnimationFrame(()=>{ requestAnimationFrame(()=>{ roPending=false; recalc(); }) }) }
  if('ResizeObserver' in window){ const ro=new ResizeObserver(()=>qRec()); ro.observe(view) }
  window.addEventListener('resize',qRec);
  document.addEventListener('visibilitychange',()=>{ document.hidden?stopAuto():startAuto(); qRec(); });

  // Renderers
  let curr=null, cycId=null;
  function displayName(o){ if(riskRe.test(o.grade)) return `${o.name} (RISK)`; if(o.rank!=null) return `${o.name} (SAFE #${o.rank})`; return o.name }
  function show(o,user){ if(!o||typeof o!=='object') return; curr=o; const risky=riskRe.test(o.grade||''); elN.textContent=displayName(o); elR.innerHTML=o.rank?('Tourism Rank #'+o.rank):'(Unranked)'; elG.innerHTML='Safety Grade <span class="badge '+gColor(o.grade)+'">'+o.grade+'</span> — '+GEXP[o.grade]; elG.classList.remove('green','black','red'); elG.classList.add(gColor(o.grade)); elD.textContent=core(o); elM.innerHTML=''; if(mode==='deep'){ cycle(o) } qRec(); if(user){ save(o.name); lock(); setQuery(o.name); if(o.rank!=null){ const idx=GOOD.findIndex(x=>x.key===o.key); if(idx>-1){ goodIdx=idx+1; phase='risk'; } } else if(riskRe.test(o.grade)){ phase='good' } } sr.textContent=o.name+' loaded.' }
  function cycle(o){ const paras=[full(o),micro()]; let i=0; clearInterval(cycId); elM.innerHTML='<div>'+paras[0]+'</div>'; cycId=setInterval(()=>{ i=(i+1)%paras.length; elM.innerHTML='<div>'+paras[i]+'</div>'; qRec() },7000) }
  function render(input){ const txt=cleanInput(input); if(!txt){ elN.textContent='—'; elR.textContent='—'; elG.textContent='—'; elD.textContent='Choose a country or press Risk.'; elM.innerHTML=''; qRec(); return } const key=bestMatch(txt)||txt.toLowerCase(); const hit=DB[key]; if(hit) show(hit,false) }

  // URL state
  function getQuery(){ try{ const u=new URL(location.href); return u.searchParams.get('country')||'' } catch(_){ return '' } }
  function setQuery(c){ try{ const u=new URL(location.href); if(c){ u.searchParams.set('country',c) } else { u.searchParams.delete('country') } history.replaceState(null,'',u) } catch(_){} }

  // Events
  riskBtn.addEventListener('click',(()=>{ let i=0; return ()=>{ const o=RISK_SORTED[i % RISK_SORTED.length]; i++; show(o,true); } })());
  q.addEventListener('change',function(){ const v=cleanInput(this.value); const key=bestMatch(v)||v.toLowerCase(); if(DB[key]) show(DB[key],true) });
  let live=null; q.addEventListener('input',function(){ clearTimeout(live); const v=cleanInput(this.value); const k=bestMatch(v)||v.toLowerCase(); const g=(DB[k]||{}).grade||''; this.style.color=/^d|^e|^f/i.test(g)?'#b01919':''; live=setTimeout(()=>render(v),250) });

  // Tests
  (function tests(){ try{ console.group('[Ticker tests]'); console.assert(GOOD[0].rank===1,'GOOD sorted by rank asc'); console.assert(RISK_SORTED.length>=1,'risk list exists'); const ms=DB['malaysia']; console.assert(ms && !riskRe.test(ms.grade) && /SAFE #14$/.test(`${ms.name} (SAFE #${ms.rank})`),'Malaysia SAFE #14 label'); recalc(); const expH=parseInt(getComputedStyle(box).getPropertyValue('--expanded-h'))||box.scrollHeight; const colH=parseInt(getComputedStyle(box).getPropertyValue('--collapsed-h'))||Math.round(expH*COLLAPSE_PCT); console.assert(colH>=160,'collapsed ≥ sample size'); console.groupEnd(); }catch(err){ console.error('[Ticker tests] failed',err) } })();

  // Init: show last or rank #1, compute heights, start single auto timer
  (function init(){ const from=cleanInput(getQuery()||load()||GOOD[0].name); const seed=DB[asString(from).toLowerCase()]||GOOD[0]; show(seed,false); recalc(); startAuto(); })();
})();
</script>
